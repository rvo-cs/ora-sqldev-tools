<?xml version="1.0" encoding="UTF-8" ?>
<displays>
<display id="cc79a54f-0178-1000-8009-c0a8010c27da" type="" style="Script" enable="true">
	<name><![CDATA[AWR - Plain AWR report - HTML [11.2]]]></name>
	<description><![CDATA[Generates, and spools to an output file, an AWR report in HTML format.
Use the "AWR - Available snapshots" report to retrieve the begin & end snapshot ids.]]></description>
	<tooltip><![CDATA[]]></tooltip>
	<drillclass><![CDATA[]]></drillclass>
	<CustomValues>
	</CustomValues>
	<query>
		<sql><![CDATA[whenever sqlerror exit failure rollback
whenever oserror exit failure rollback

set long 5000000
set linesize 10000
set trimspool on
set heading off
set feedback off
set pagesize 0

set termout off
set verify off

define spool_directory
define spool_filename

column spool_directory noprint new_value spool_directory
column spool_filename noprint new_value spool_filename

select NVL(:SPOOL_DIR, :DEFAULT_SPOOL_DIR) as spool_directory 
from dual;

select NVL(:SPOOL_FILENAME, 
        'AWR-' 
            || sys_context('USERENV', 'INSTANCE_NAME')
            || '-' || :SNAP_ID_BEGIN || '-' || :SNAP_ID_END
            || '-' || to_char(sysdate, 'YYYYMMDD_HH24MISS')
            || '.html')
    as spool_filename 
from dual;

cd "&spool_directory"

spool "&spool_filename"

select * from table(
    dbms_workload_repository.awr_report_html(
        l_dbid => nvl(:DBID, (select dbid from v$database)),
        l_inst_num => nvl(:INST_ID, sys_context('USERENV', 'INSTANCE')),
        l_bid => :SNAP_ID_BEGIN,
        l_eid => :SNAP_ID_END,
        l_options => nvl(:OPTIONS, 8)
    ))
;

spool off

set termout on

select 'AWR report completed: ' 
    || '&spool_filename'
    || ' (directory: &spool_directory)'
from dual;]]></sql>
		<binds>
			<bind id="SPOOL_DIR">
				<prompt><![CDATA[Spool directory?]]></prompt>
				<tooltip><![CDATA[Spool directory (NULL: use default)]]></tooltip>
				<value><![CDATA[NULL_VALUE]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="DEFAULT_SPOOL_DIR">
				<prompt><![CDATA[Default spool directory?]]></prompt>
				<tooltip><![CDATA[Default spool directory]]></tooltip>
				<value><![CDATA[E:\Home\romain\SQL_Developer\output\awr_html]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="SPOOL_FILENAME">
				<prompt><![CDATA[Spool filename?]]></prompt>
				<tooltip><![CDATA[Spool filename (NULL: use default naming convention)]]></tooltip>
				<value><![CDATA[NULL_VALUE]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="SNAP_ID_BEGIN">
				<prompt><![CDATA[Start snap id?]]></prompt>
				<tooltip><![CDATA[Start snap id -- NB: report starts at END_INTERVAL_TIME]]></tooltip>
				<value><![CDATA[80]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="SNAP_ID_END">
				<prompt><![CDATA[End snap id?]]></prompt>
				<tooltip><![CDATA[End snap id]]></tooltip>
				<value><![CDATA[85]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="DBID">
				<prompt><![CDATA[DB Id?]]></prompt>
				<tooltip><![CDATA[DB Id (NULL = use current DB Id)]]></tooltip>
				<value><![CDATA[NULL_VALUE]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="INST_ID">
				<prompt><![CDATA[Instance number?]]></prompt>
				<tooltip><![CDATA[Instance number (NULL = use current instance)]]></tooltip>
				<value><![CDATA[NULL_VALUE]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
			<bind id="OPTIONS">
				<prompt><![CDATA[Options?]]></prompt>
				<tooltip><![CDATA[Report options (default: 8)]]></tooltip>
				<value><![CDATA[NULL_VALUE]]></value>
				<bracket><![CDATA[null]]></bracket>
			</bind>
		</binds>
	</query>
		<pdf version="VERSION_1_7" compression="CONTENT">
			<docproperty title="" author="" subject="" keywords="" />
			<cell toppadding="2" bottompadding="2" leftpadding="2" rightpadding="2" horizontalalign="LEFT" verticalalign="TOP" wrap="true" />
			<column>
				<heading font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="FIRST_PAGE" />
				<footing font="null" size="10" style="NORMAL" color="-16777216" rowshading="-1" labeling="NONE" />
				<blob blob="NONE" zip="false" />
			</column>
			<table font="Times New Roman" size="10" style="NORMAL" color="-16777216" userowshading="false" oddrowshading="-1" evenrowshading="-1" showborders="true" spacingbefore="12" spacingafter="12" horizontalalign="LEFT" />
			<header enable="false" generatedate="false">
				<data>
				null				</data>
			</header>
			<footer enable="false" generatedate="false">
				<data value="null" />
			</footer>
			<pagesetup papersize="LETTER" orientation="1" measurement="in" margintop="1.0" marginbottom="1.0" marginleft="1.0" marginright="1.0" />
		</pdf>
</display>
</displays>
